# SOC-Automation-Lab

Acknowledgement: This project benefitted greatly from the tutorial provided by the Youtube Channel [MYDFIR](https://www.youtube.com/@mydfir). MYDFIR's video series on the project were extremly helpful in understanding and implementing the various elements of the SOC Automation Lab project

## 1. Introduction

### 1.1 Overview
This project aims to develop an automated SOC homelab, highly inspired by MyDFIR’s youtube series on the same topic. The full playlist can be found at [SOC Automation Project](https://www.youtube.com/watch?v=XR3eamn8ydQ). In today’s rapidly changing cybersecurity environment, the importance of having a strong Security Operations Center (SOC) has never been greater. As cyber threats grow more advanced, organizations must constantly evolve and improve their detection and response capabilities to protect their assets and data. For aspiring SOC analysts, one method is to build a fully automated SOC homelab to hone their skills in a controlled environment. 

### 1.2 Objectives
- **Hands-on Experience- The primary objective of this project is to provide oneself with hands-on experience in setting up, configuring, and operating a Security Operations Center in a simulated environment.
- **Experience with Tools- By using a range of open-source tools commonly used in real-world SOCs, including Wazuh for alert generation, Shuffle for SOAR (Security Orchestration, Automation, and Response) and TheHive for case management.
- **Incident Response Training- We can simulate various cybersecurity incidents, allowing aspiring analysts to practice incident detection, analysis, and response procedures in a controlled setting.
- **Integration Testing- The project can also teach how to integrate different security tools seamlessly to streamline the incident response process.
- **Threat Intelligence Enrichment- This project incorporates threat intelligence enrichment capabilities, enabling analysts to enrich the Indicator of Compromise (IOCs) through services like VirusTotal. 

## 2. Prerequisites

### 2.1 Infrastructure Requirements
- Virtualization Platform- Use a virtualization platform such as Virtualbox 7.0 or VMWare Workstation 17 Player.
- Cloud Service Provider- Use cloud services such as DigtialOcean, Azure, Google Cloud or AWS for hosting centralized components such as the Wazuh server.

### 2.2 Hardware Requirements
-  A host machine capable of running multiple virtual machines simultaneously.
-  Sufficient CPU (8-24 cores), Memory (32-64GB) and disk space to support the VM's and their expected workloads.

### Components 
- Windows 10 virtual machine: Will serve as the endpoint for telemetry generation using Sysmon
- Wazuh Server: Deployed on a cloud instance to centralize and manage alerts generated by our Win 10 virtual machine
- Wazuh Agent: Installed on the Windows 10 VM to collect the telemetry data and forward it to the Wazuh server.
- Shuffle: Implemented as our SOAR tool to automate response actions based on incoming alerts from Wazuh.
- TheHive: Deployed for centralized case management, enabling analysts to track and respond

## 3. Setup

### 3.1 Step 1: Installation and Configuration of Windows 10 with Sysmon
To begin with, you are going to want create a Windows 10 .iso file. This can be done with the following link: https://www.microsoft.com/en-us/software-download/windows10. Once done, use your choice of virtualization platform to create your windows 10 virtual machine. After your virtual machine has been created, install Sysmon from the official Microsoft sysinternals site and sysmonconfig.xml from the github page [sysmon-modular](https://github.com/olafhartong/sysmon-modular). You’ll want to unzip the downloaded Sysmon file and place the sysmonconfig.xml in the Sysmon file. Then open powershell as administrator and navigate to the Sysmon directory and run the following command: .\sysmon64.exe -i sysmonconfig.xml to start the installation. To verify, you can open the Windows services manager and check for “Sysmon” in services list. 

### 3.2: Step 2: Installing and Configuring Wazuh
For this part, you’ll want to create an account on DigitalOcean. If you’re a student in university, I recommend signing up for Github Education as you’ll will receive $200 in free credits for DigitalOcean which will be more than enough. For my droplet, I went with Ubuntu 22.04 for the OS and $48/mo plan and created an ssh key for sign in purposes. Once done, you’ll need to set up the firewall for the Wazuh server. The inbound rules should allow all TCP/UDP connections to your public ip.   To connect, use either through the droplet console or via ssh through the droplet ip.  
![image](https://github.com/user-attachments/assets/2b905af7-975f-49ee-93aa-85e0bd809b54)

Once created, run apt-get update && apt-get upgrade -y. You’ll be asked about which services to update, but you can skip them. 
To install Wazuh, use the following command: curl -sO https://packages.wazuh.com/4.7/wazuh-install.sh && sudo bash ./wazuh-install.sh -a. If all goes well, you should see the username and password for the wazuh server. Copy it to a safe place, go back into your win10 vm and use the public ip of the wazuh along with the admin account(http://your_droplet_ip). You should be able to login but if you're unable to, use systemctl status wazuh.manager-system to check if wazuh is running.

### 3.2: Step 3: Setting up The Hive
To begin, use the same configuration as the Wazuh server and install TheHive using [Github link](https://github.com/MyDFIR/SOC-Automation-Project). 
Once done, you’ll need to configure Cassandra by editing the configuration file nano /etc/cassandra/cassandra.yaml. You’ll need to set the cluster-name, the listen_address and the rpc_address to the TheHive IP address, and the seed_provider to TheHive public IP. Save the file, stop the service and remove old files in /var/lib/Cassandra/* using rm -rf. Once done, run systemctl start cassandra.service.  
After that, Elasticsearch configuration file by removing hashtags i.e from comment to code. You'll want to uncomment the following:

-cluster.name: Set to thehive
-node.name- this can be node1
-network.host: Set to your server’s public IP
-http.port (optional because by default it’s 9200)

![image](https://github.com/user-attachments/assets/8ba8da77-85fd-4165-852a-a994cb600ed4)

Once done, change owner to thehive user and thehive group over to the intend directories.
![image](https://github.com/user-attachments/assets/c216a202-a8c4-40f4-befd-964ec9bb07b1)

